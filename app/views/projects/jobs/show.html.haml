- content_for :breadcrumb do
  - nodes = [{ label: project_breadcrumb_name(@project), path: dashboard_project_path(@project) }, { label: 'Jobs', path: pipeline_jobs_path(@job.pipeline) }, { label: "##{@job.id}", path: job_path(@job)}]
  = render 'shared/breadcrumb', nodes: nodes

%div{ class: 'w-full bg-white p-6' }
  %div{ class: 'w-full max-w-6xl mx-auto flex flex-col px-4' }

    %div{ class: 'mb-2' }
      %div{ class: 'flex items-start justify-between mb-4' }
        %div{ class: 'flex-1 min-w-0' }
          %div{ class: 'flex items-center gap-3 mb-4' }
            - status_colors = { 'success' => 'bg-emerald-50 text-emerald-600 border-emerald-200', 'failed' => 'bg-rose-50 text-rose-600 border-rose-200', 'running' => 'bg-blue-50 text-blue-600 border-blue-200', 'pending' => 'bg-amber-50 text-amber-600 border-amber-200' }
            %div{ class: "w-8 h-8 rounded-full border flex items-center justify-center #{status_colors.fetch(@job.status, 'bg-slate-50 text-slate-500 border-slate-200')}" }
              - case @job.status
              - when 'success'
                = icon 'check', class: 'w-3.5 h-3.5 font-medium'
              - when 'running'
                = icon 'approximate-equals', class: 'w-3.5 h-3.5 font-medium'
              - when 'failed'
                = icon 'x', class: 'w-3.5 h-3.5 font-medium'
              - when 'pending'
                = icon 'hourglass-medium', class: 'w-3.5 h-3.5 font-medium'
              - else
                = icon 'minus', class: 'w-3.5 h-3.5 font-medium'

            %div{ class: 'flex-1 min-w-0' }
              %div{ class: 'flex items-center gap-2 mb-1' }
                %h1{ class: 'text-xl font-semibold text-gray-900' }
                  = @job.name
                - badge_colors = { 'success' => 'bg-emerald-500/10 text-emerald-700 ring-1 ring-emerald-500/20', 'failed' => 'bg-rose-500/10 text-rose-700 ring-1 ring-rose-500/20', 'running' => 'bg-blue-500/10 text-blue-700 ring-1 ring-blue-500/20', 'pending' => 'bg-amber-500/10 text-amber-700 ring-1 ring-amber-500/20' }
                %span{ class: "inline-flex items-center px-2 py-0.5 text-xs font-medium rounded #{badge_colors.fetch(@job.status, 'bg-slate-500/10 text-slate-700 ring-1 ring-slate-500/20')}" }
                  = @job.status.titleize

        %div{ class: 'flex-shrink-0' }
          %div{ class: 'flex items-center gap-2' }

            - if ['failed', 'success'].include?(@job.status)
              %button{ class: 'inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 transition-colors' }
                = icon 'arrow-clockwise', class: 'w-4 h-4'
                Retry

      %div{ class: 'flex items-center gap-6 text-sm text-slate-600 mb-4' }
        %div{ class: 'flex items-center gap-1.5' }
          %span Started
          = time_ago_in_words(@job.created_at) + ' ago by'
          - if @job.user&.avatar&.present?
            = image_tag @job.user.avatar_url, class: 'w-4 h-4 rounded-full object-cover ring-1 ring-white shadow-sm ml-1'
          - else
            %div{ class: 'w-4 h-4 rounded-full bg-gradient-to-br from-slate-400 to-slate-500 flex items-center justify-center text-xs font-bold text-white shadow-sm ml-1' }
              = @job.user&.name&.first&.upcase || '?'
          %span{ class: 'font-medium text-slate-700' }
            = @job.user&.name || 'Unknown'

        %div{ class: 'flex items-center gap-1.5' }
          = icon 'git-branch', class: 'w-4 h-4 text-slate-500'
          = link_to pipeline_jobs_path(@job.pipeline), class: 'text-blue-600 hover:text-blue-700 font-medium transition-colors' do
            Pipeline ##{@job.pipeline.id}

        - if @job.pipeline.sha
          %div{ class: 'flex items-center gap-1.5' }
            = icon 'git-commit', class: 'w-4 h-4 text-slate-500'
            %span{ class: 'font-mono text-slate-600 text-xs' }
              = @job.pipeline.sha[0..7]

      %div{ class: 'flex items-center justify-between mb-2' }
        %div{ class: 'flex items-center gap-2' }
          = icon 'terminal-window', class: 'w-4 h-4 text-slate-500'
          %span{ class: 'text-sm font-medium text-slate-700' }
            Job output
        %div{ class: 'flex items-center gap-1' }
          = link_to raw_namespace_project_job_path(@project.namespace.parent.full_path, @project.path, @job), class: 'inline-flex items-center gap-1 px-2 py-1 text-xs text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded transition-colors' do
            = icon 'download', class: 'w-3 h-3'
            Download

    %div{ class: 'term-box bg-gray-900 text-white py-4 px-8 text-xs/5 rounded-lg whitespace-normal break-all overflow-x-auto' }
      - if @job.trace.present?
        = @job.trace.html.html_safe
      - else
        %div{ class: 'text-center py-12 text-gray-400' }
          %div{ class: 'mb-4' }
            = icon 'file-text', class: 'w-8 h-8 mx-auto opacity-50'
          %p{ class: 'text-sm' }
            No output available for this job yet
