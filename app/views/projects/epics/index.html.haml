- content_for :breadcrumb do
  - nodes = [{ label: @project.name, path: dashboard_project_path(@project) }, { label: 'Epics', path: namespace_project_epics_path(@project.namespace.parent.full_path, @project.namespace.path) }]
  = render 'shared/breadcrumb', nodes: nodes

%div{ class: 'w-full bg-white p-6' }
  %div{ class: 'w-full max-w-6xl mx-auto flex flex-col px-4' }

    %div{ class: 'border-b border-slate-200 mb-6' }
      %div{ class: 'flex items-center justify-between' }
        %nav{ class: 'flex space-x-8' }
          - opened_class = (params[:status].blank? || params[:status] == 'opened') ? 'border-b-2 border-blue-600 pb-4 px-1 text-sm font-medium text-blue-600' : 'border-b-2 border-transparent pb-4 px-1 text-sm font-medium text-slate-500 hover:text-slate-700 hover:border-slate-300 transition-colors'
          = link_to namespace_project_epics_path(@project.namespace.parent.full_path, @project.namespace.path, status: 'opened'), class: opened_class do
            Open
            %span{ class: 'ml-2 px-2 py-0.5 bg-blue-100 text-blue-600 rounded-full text-xs font-medium' }= @opened_count

          - closed_class = params[:status] == 'closed' ? 'border-b-2 border-blue-600 pb-4 px-1 text-sm font-medium text-blue-600' : 'border-b-2 border-transparent pb-4 px-1 text-sm font-medium text-slate-500 hover:text-slate-700 hover:border-slate-300 transition-colors'
          = link_to namespace_project_epics_path(@project.namespace.parent.full_path, @project.namespace.path, status: 'closed'), class: closed_class do
            Closed
            %span{ class: 'ml-2 px-2 py-0.5 bg-slate-100 text-slate-500 rounded-full text-xs font-medium' }= @closed_count

        - if @epics&.any?
          %div{ class: 'pb-2' }
            = link_to new_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path), class: 'inline-flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md transition-all duration-200' do
              = icon 'plus', class: 'w-4 h-4'
              %span New epic

    / -- Search Filter --
    %div{ class: 'bg-gray-50 rounded-lg p-4 mb-6' }
      = form_tag namespace_project_epics_path(@project.namespace.parent.full_path, @project.namespace.path), method: :get, local: true, class: 'flex flex-wrap gap-4 items-end' do
        = hidden_field_tag :status, params[:status] if params[:status].present?

        %div{ class: 'flex-1 min-w-64' }
          = text_field_tag :search, params[:search], placeholder: 'Type to search', class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500', onkeypress: 'if(event.key==="Enter"){this.form.submit();}', autocomplete: 'off'

    - if @epics&.any?
      %div{ class: 'space-y-0' }
        - @epics.each_with_index do |epic, index|
          %div{ class: "group flex items-start gap-4 px-6 py-5 hover:bg-slate-50/50 transition-all duration-200 #{'border-t border-slate-100' if index > 0}" }
            %div{ class: 'flex-1 min-w-0' }
              %div{ class: 'mb-2' }
                %h3{ class: 'text-base font-semibold text-slate-900 hover:text-blue-600 transition-colors cursor-pointer' }
                  = link_to epic.title, namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, epic), class: 'hover:text-blue-600 transition-colors'
                  - if epic.confidential?
                    %span{ class: 'ml-2 px-2 py-0.5 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium' } Confidential

              - if epic.description.present?
                %p{ class: 'text-sm text-slate-600 mb-3 line-clamp-2' }= truncate(strip_markdown(epic.description), length: 120)

              %div{ class: 'flex items-center gap-4 text-sm' }
                %div{ class: 'flex items-center gap-2 text-slate-500' }
                  - if epic.author&.avatar&.present?
                    = image_tag epic.author.avatar_url, class: 'w-4 h-4 rounded-full'
                  - else
                    %div{ class: 'w-4 h-4 rounded-full bg-gradient-to-br from-slate-400 to-slate-500 flex items-center justify-center text-xs font-bold text-white' }
                      = epic.author&.name&.first&.upcase || '?'
                  %span
                    opened #{time_ago_in_words(epic.created_at)} ago by
                    %span{ class: 'font-medium' }= epic.author&.name || 'Unknown'

                - if epic.due_date
                  %div{ class: 'flex items-center gap-1 text-slate-500' }
                    = icon 'calendar', class: 'w-3 h-3'
                    %span due #{epic.due_date.strftime("%b %d, %Y")}

      - if @epics.respond_to?(:current_page)
        %div{ class: 'mt-8 flex justify-center' }
          = paginate @epics

    - else
      %div{ class: 'text-center py-16 bg-white border border-slate-200 rounded-lg' }
        %div{ class: 'mx-auto w-16 h-16 flex items-center justify-center rounded-2xl bg-slate-100 mb-6' }
          = icon 'notepad', class: 'w-8 h-8 text-slate-400'
        %h3{ class: 'text-lg font-semibold text-slate-900 mb-2' } Organize large features and initiatives
        %p{ class: 'text-slate-500 max-w-sm mx-auto leading-relaxed mb-6' }
          Track high-level work that spans multiple issues and teams.
        = link_to new_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path), class: 'inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200' do
          = icon 'plus', class: 'w-4 h-4'
          %span New epic