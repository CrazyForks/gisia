- content_for :breadcrumb do
  - nodes = [{ label: project_breadcrumb_name(@project), path: project_path(@project) }, { label: 'Epics', path: namespace_project_epics_path(@project.namespace.parent.full_path, @project.namespace.path) }, { label: @epic.title, path: namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic) }]
  = render 'shared/breadcrumb', nodes: nodes

%div{ class: 'w-full bg-white p-6' }
  %div{ class: 'w-full max-w-6xl mx-auto flex flex-col px-4' }
    .epic-details
      .epic-header.border-b.border-gray-200.pb-4.mb-6
        .flex.justify-between
          .flex-1
            .epic-title-container
              %h1.text-2xl.font-bold.text-gray-900.mb-2
                = @epic.title
              - if @epic.confidential?
                %span.badge.badge-warning.mb-2 Confidential
            .epic-meta.text-sm.text-gray-500
              = "opened by"
              %span.text-gray-700= @epic.author.name
              = time_ago_in_words(@epic.created_at)
              ago
              - if @epic.updated_by && @epic.updated_by != @epic.author
                %span.ml-4
                  Updated by
                  %span.text-gray-700= @epic.updated_by.name
                  = time_ago_in_words(@epic.updated_at)
                  ago
          .epic-actions.flex.gap-1.5.items-end
            = link_to edit_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic), class: "inline-flex items-center px-2 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-300 rounded hover:bg-slate-50 focus:outline-none focus:ring-1 focus:ring-blue-500" do
              = icon("pencil", class: "w-3 h-3 mr-1")
              Edit
            - if @epic.opened?
              = button_to close_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic), method: :patch, class: "inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 bg-white border border-red-300 rounded hover:bg-red-50 focus:outline-none focus:ring-1 focus:ring-red-500" do
                = icon("x", class: "w-3 h-3 mr-1")
                Close
            - elsif @epic.closed?
              = button_to reopen_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic), method: :patch, class: "inline-flex items-center px-2 py-1 text-xs font-medium text-green-700 bg-white border border-green-300 rounded hover:bg-green-50 focus:outline-none focus:ring-1 focus:ring-green-500" do
                = icon("arrow-clockwise", class: "w-3 h-3 mr-1")
                Reopen

      .epic-content
        .flex.gap-4
          .epic-main.flex-1
            - if @epic.description_html.present?
              .epic-description.prose.max-w-none.markdown
                = @epic.description_html.html_safe
            - else
              .no-description.text-gray-500.italic
                No description provided.

            = render 'shared/epics/children_list', epic: @epic

            = render 'shared/notes/notes_with_form', notes: @notes, noteable: @epic

          .epic-sidebar.w-64.space-y-6
            .bg-slate-50.p-3.rounded-lg.border.border-slate-200
              .sidebar-section.mb-3
                %h4.text-xs.font-semibold.text-slate-900.mb-1.5.tracking-wide Status
                - if @epic.closed?
                  .inline-flex.items-center.px-2.py-1.text-xs.font-medium.text-red-800.bg-red-100.rounded-full
                    = icon("x", class: "w-3 h-3 mr-1")
                    Closed
                  - if @epic.closed_by
                    .text-xs.text-slate-600.mt-1
                      Closed by
                      %span.text-slate-700= @epic.closed_by.name
                      - if @epic.closed_at
                        = time_ago_in_words(@epic.closed_at)
                        ago
                - else
                  .inline-flex.items-center.px-2.py-1.text-xs.font-medium.text-green-800.bg-green-100.rounded-full
                    = icon("check-circle", class: "w-3 h-3 mr-1")
                    Open

              - if @epic.due_date
                .sidebar-section.mb-3
                  %h4.text-xs.font-semibold.text-slate-900.mb-1.5.tracking-wide Due date
                  .text-sm.text-slate-700
                    = @epic.due_date.strftime("%B %d, %Y")

            = render 'shared/assignees/user_selection_card', resource: @epic, resource_type: 'epic', users: @epic.assignees, field_type: 'assignees', title: 'Assignees', selected_user_ids: @epic.assignee_ids.join(','), avatar_color: 'from-blue-400 to-blue-500', empty_icon: 'user-plus', empty_message: 'No assignees', search_url: search_users_namespace_project_epics_path(@project.namespace.parent.full_path, @project.namespace.path), update_url: namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic)

            = render 'shared/labels/label_selection_card', resource: @epic, resource_type: 'epic', labels: @epic.labels, selected_label_ids: @epic.label_ids.join(','), search_url: search_labels_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic), update_url: link_labels_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic), unlink_url: unlink_label_namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic)

            = render 'shared/epics/epic_selection_card', resource: @epic, resource_type: 'epic', parent: @epic.parent, title: 'Parent Epic', selected_id: @epic.parent_id, search_url: search_epics_namespace_project_epics_path(@project.namespace.parent.full_path, @project.namespace.path), update_url: namespace_project_epic_path(@project.namespace.parent.full_path, @project.namespace.path, @epic)
