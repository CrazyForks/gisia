- content_for :breadcrumb do
  - nodes = [{ label: @project.name, path: dashboard_project_path(@project) }, { label: 'Merge Requests', path: namespace_project_merge_requests_path(@project.namespace.parent.full_path, @project.path) }, { label: "##{@merge_request.id}", path: namespace_project_merge_request_path(@merge_request.target_project.namespace.parent.full_path, @merge_request.target_project.path, @merge_request) }, { label: 'Edit' }]
  = render 'shared/breadcrumb', nodes: nodes

%div{ class: 'w-full bg-white p-6' }
  %div{ class: 'w-full max-w-6xl mx-auto flex flex-col px-4' }
    %div{ class: 'mb-8' }
      %h1{ class: 'text-2xl font-bold text-slate-900 mb-2' } Edit merge request
      %p{ class: 'text-slate-600' } Update the details of your merge request

    = form_with model: [@project.namespace.parent.full_path, @project.path, @merge_request], url: namespace_project_merge_request_path(@project.namespace.parent.full_path, @project.path, @merge_request), local: true, data: { turbo: false } do |f|
      - if @merge_request.errors.any?
        %div{ class: 'bg-red-50 border border-red-200 rounded-lg p-4 mb-6' }
          %h3{ class: 'text-red-800 font-medium mb-2' } Please correct the following errors:
          %ul{ class: 'text-red-700 text-sm space-y-1' }
            - @merge_request.errors.full_messages.each do |message|
              %li= message

      %div{ class: 'space-y-6' }
        %div
          = f.label :title, class: 'block text-sm font-medium text-slate-700 mb-2'
          = f.text_field :title, class: 'w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500', placeholder: 'Enter merge request title'

        %div
          = f.label :description, class: 'block text-sm font-medium text-slate-700 mb-2'
          = f.text_area :description, rows: 8, class: 'w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500', placeholder: 'Describe the changes in this merge request'

        %div{ class: 'grid grid-cols-1 md:grid-cols-2 gap-6' }
          %div
            = f.label :source_branch, class: 'block text-sm font-medium text-slate-700 mb-2'
            = f.select :source_branch, options_from_collection_for_select(@branches, :to_s, :to_s, @merge_request.source_branch), { prompt: 'Select source branch' }, { class: 'w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }

          %div
            = f.label :target_branch, class: 'block text-sm font-medium text-slate-700 mb-2'
            = f.select :target_branch, options_from_collection_for_select(@branches, :to_s, :to_s, @merge_request.target_branch), { prompt: 'Select target branch' }, { class: 'w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }

        %div{ class: 'grid grid-cols-1 md:grid-cols-2 gap-6' }
          %div
            = f.label :assignee_ids, 'Assignees', class: 'block text-sm font-medium text-slate-700 mb-2'
            = render 'shared/user_multi_select', search_url: search_users_namespace_project_merge_requests_path(@project.namespace.parent.full_path, @project.path), selected_ids: @merge_request.assignee_ids, field_name: 'merge_request[assignee_ids][]', placeholder: 'Search and select assignees by username...'

          %div
            = f.label :reviewer_ids, 'Reviewers', class: 'block text-sm font-medium text-slate-700 mb-2'
            = render 'shared/user_multi_select', search_url: search_users_namespace_project_merge_requests_path(@project.namespace.parent.full_path, @project.path), selected_ids: @merge_request.reviewer_ids, field_name: 'merge_request[reviewer_ids][]', placeholder: 'Search and select reviewers by username...'

      %div{ class: 'flex items-center gap-4 pt-6 border-t border-slate-200' }
        = f.submit 'Update merge request', class: 'px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200'
        = link_to 'Cancel', namespace_project_merge_request_path(@merge_request.target_project.namespace.parent.full_path, @merge_request.target_project.path, @merge_request), class: 'px-6 py-2 border border-slate-300 text-slate-700 hover:bg-slate-50 rounded-lg font-medium transition-colors duration-200'