
- content_for :breadcrumb do
  - nodes = [{ label: @project.name, path: dashboard_project_path(@project) }, { label: 'Issues', path: project_issues_path(@project) }, { label: @issue.to_reference, path: issue_path(@issue) }]
  = render 'shared/breadcrumb', nodes: nodes

%div{ class: 'w-full bg-white p-6' }
  %div{ class: 'w-full max-w-6xl mx-auto flex flex-col px-4' }
    .issue-details
      .issue-header.border-b.border-gray-200.pb-4.mb-6
        .flex.justify-between
          .flex-1
            .issue-title-container
              %h1.text-2xl.font-bold.text-gray-900.mb-2
                = @issue.title
              - if @issue.confidential?
                %span.badge.badge-warning.mb-2 Confidential
            .issue-meta.text-sm.text-gray-500
              = "opened by"
              %span.text-gray-700= @issue.author.name
              = time_ago_in_words(@issue.created_at)
              ago
              - if @issue.updated_by && @issue.updated_by != @issue.author
                %span.ml-4
                  Updated by
                  %span.text-gray-700= @issue.updated_by.name
                  = time_ago_in_words(@issue.updated_at)
                  ago
          .issue-actions.flex.gap-1.5.items-end
            = link_to edit_namespace_project_issue_path(@project.namespace.parent.full_path, @project.path, @issue), class: "inline-flex items-center px-2 py-1 text-xs font-medium text-slate-700 bg-white border border-slate-300 rounded hover:bg-slate-50 focus:outline-none focus:ring-1 focus:ring-blue-500" do
              = icon("pencil", class: "w-3 h-3 mr-1")
              Edit
            - if @issue.opened?
              = button_to close_namespace_project_issue_path(@project.namespace.parent.full_path, @project.path, @issue), method: :patch, class: "inline-flex items-center px-2 py-1 text-xs font-medium text-red-700 bg-white border border-red-300 rounded hover:bg-red-50 focus:outline-none focus:ring-1 focus:ring-red-500" do
                = icon("x", class: "w-3 h-3 mr-1")
                Close
            - elsif @issue.closed?
              = button_to reopen_namespace_project_issue_path(@project.namespace.parent.full_path, @project.path, @issue), method: :patch, class: "inline-flex items-center px-2 py-1 text-xs font-medium text-green-700 bg-white border border-green-300 rounded hover:bg-green-50 focus:outline-none focus:ring-1 focus:ring-green-500" do
                = icon("arrow-clockwise", class: "w-3 h-3 mr-1")
                Reopen

      .issue-content
        .flex.gap-4
          .issue-main.flex-1
            - if @issue.description_html.present?
              .issue-description.prose.max-w-none.markdown
                = @issue.description_html.html_safe
            - else
              .no-description.text-gray-500.italic
                No description provided.

            = render 'shared/notes/notes_with_form', notes: @notes, noteable: @issue

          .issue-sidebar.w-64.space-y-6
            .bg-slate-50.p-3.rounded-lg.border.border-slate-200
              .sidebar-section.mb-3
                %h4.text-xs.font-semibold.text-slate-900.mb-1.5.tracking-wide Status
                - if @issue.closed?
                  .inline-flex.items-center.px-2.py-1.text-xs.font-medium.text-red-800.bg-red-100.rounded-full
                    = icon("x", class: "w-3 h-3 mr-1")
                    Closed
                  - if @issue.closed_by
                    .text-xs.text-slate-600.mt-1
                      Closed by
                      %span.text-slate-700= @issue.closed_by.name
                      - if @issue.closed_at
                        = time_ago_in_words(@issue.closed_at)
                        ago
                - else
                  .inline-flex.items-center.px-2.py-1.text-xs.font-medium.text-green-800.bg-green-100.rounded-full
                    = icon("check-circle", class: "w-3 h-3 mr-1")
                    Open

              - if @issue.due_date
                .sidebar-section.mb-3
                  %h4.text-xs.font-semibold.text-slate-900.mb-1.5.tracking-wide Due date
                  .text-sm.text-slate-700
                    = @issue.due_date.strftime("%B %d, %Y")

            = render 'shared/assignees/user_selection_card', resource: @issue, resource_type: 'issue', users: @issue.assignees, field_type: 'assignees', title: 'Assignees', selected_user_ids: @issue.assignee_ids.join(','), avatar_color: 'from-blue-400 to-blue-500', empty_icon: 'user-plus', empty_message: 'No assignees', search_url: search_users_namespace_project_issues_path(@project.namespace.parent.full_path, @project.path), update_url: namespace_project_issue_path(@project.namespace.parent.full_path, @project.path, @issue)

            = render 'shared/labels/label_selection_card', resource: @issue, resource_type: 'issue', labels: @issue.labels, selected_label_ids: @issue.label_ids.join(','), search_url: search_labels_namespace_project_issue_path(@project.namespace.parent.full_path, @project.path, @issue), update_url: link_labels_namespace_project_issue_path(@project.namespace.parent.full_path, @project.path, @issue), unlink_url: unlink_label_namespace_project_issue_path(@project.namespace.parent.full_path, @project.path, @issue)

