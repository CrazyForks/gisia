- content_for :breadcrumb do
  - nodes = [{ label: 'Admin', path: admin_root_path }, { label: 'Jobs', path: '#' }]
  = render 'shared/breadcrumb', nodes: nodes

%div{class: 'w-full bg-white p-2 rounded-lg'}
  %div{class: 'w-full max-w-6xl mx-auto'}

    %div{class: 'py-6'}
      %div{class: 'flex items-center justify-between mb-8'}
        %div
          %h1{class: 'text-2xl font-bold text-gray-900'} Jobs
          %p{class: 'text-gray-600'} Manage and monitor CI/CD jobs across all projects
        %div{class: 'flex items-center gap-3'}
          = link_to cancel_all_admin_jobs_path, class: 'inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-all duration-200', data: { turbo_method: :post, confirm: 'Are you sure you want to cancel all running and pending jobs?' } do
            = icon 'x-circle', class: 'w-4 h-4'
            Cancel All

    %div{class: 'grid grid-cols-1 md:grid-cols-4 gap-6 mb-8'}
      %div{class: 'bg-blue-50 border border-blue-200 rounded-xl p-6'}
        %div{class: 'text-center'}
          %div{class: 'flex items-center justify-center mb-2'}
            = icon 'list-checks', class: 'w-8 h-8 text-blue-600'
          %h3{class: 'text-lg font-semibold text-gray-900'} All Jobs
          %p{class: 'text-3xl font-bold text-blue-600 mt-2'}= @jobs_count

      %div{class: 'bg-green-50 border border-green-200 rounded-xl p-6'}
        %div{class: 'text-center'}
          %div{class: 'flex items-center justify-center mb-2'}
            = icon 'play', class: 'w-8 h-8 text-green-600'
          %h3{class: 'text-lg font-semibold text-gray-900'} Running
          %p{class: 'text-3xl font-bold text-green-600 mt-2'}= @running_count

      %div{class: 'bg-yellow-50 border border-yellow-200 rounded-xl p-6'}
        %div{class: 'text-center'}
          %div{class: 'flex items-center justify-center mb-2'}
            = icon 'clock', class: 'w-8 h-8 text-yellow-600'
          %h3{class: 'text-lg font-semibold text-gray-900'} Pending
          %p{class: 'text-3xl font-bold text-yellow-600 mt-2'}= @pending_count

      %div{class: 'bg-red-50 border border-red-200 rounded-xl p-6'}
        %div{class: 'text-center'}
          %div{class: 'flex items-center justify-center mb-2'}
            = icon 'x-circle', class: 'w-8 h-8 text-red-600'
          %h3{class: 'text-lg font-semibold text-gray-900'} Failed
          %p{class: 'text-3xl font-bold text-red-600 mt-2'}= @failed_count

    %div{class: 'mb-6'}
      = form_with url: admin_jobs_path, method: :get, local: false, class: 'flex items-center gap-4 mb-6', data: { turbo_frame: 'jobs_content' } do |form|
        %div{class: 'relative', data: { controller: 'searchable-select', 'searchable-select-url-value': '', 'searchable-select-selected-value': params[:status], 'searchable-select-options-value': JSON.generate([['All statuses', ''], ['Pending', 'pending'], ['Running', 'running'], ['Success', 'success'], ['Failed', 'failed'], ['Canceled', 'canceled']]) }}
          = form.hidden_field :status, { data: { 'searchable-select-target': 'hiddenInput' } }
          - current_status_text = case params[:status]
          - when 'pending' then 'Pending'
          - when 'running' then 'Running'  
          - when 'success' then 'Success'
          - when 'failed' then 'Failed'
          - when 'canceled' then 'Canceled'
          - else 'All statuses'
          %input{type: 'text', readonly: true, value: current_status_text, class: 'px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer w-40', data: { 'searchable-select-target': 'input', action: 'click->searchable-select#toggle' }}
          %div{class: 'absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg z-10 hidden', data: { 'searchable-select-target': 'dropdown' }}
            %div{data: { 'searchable-select-target': 'options' }}
              Loading...
        %div{class: 'relative', data: { controller: 'searchable-select', 'searchable-select-url-value': search_projects_admin_jobs_path, 'searchable-select-selected-value': params[:project] }}
          = form.hidden_field :project, { data: { 'searchable-select-target': 'hiddenInput' } }
          %input{type: 'text', readonly: true, value: params[:project].present? ? params[:project] : 'All projects', class: 'px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer w-48', data: { 'searchable-select-target': 'input', action: 'click->searchable-select#toggle' }}
          %div{class: 'absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg shadow-lg z-10 hidden max-h-64 overflow-y-auto', data: { 'searchable-select-target': 'dropdown' }}
            %div{class: 'p-2 border-b border-gray-200'}
              %input{type: 'text', placeholder: 'Search projects...', class: 'w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500', data: { action: 'input->searchable-select#search' }}
            %div{data: { 'searchable-select-target': 'options' }}
              Loading...

    = turbo_frame_tag 'jobs_content' do
      = render 'job_list'
