%div{ id: "note_#{note.id}", data: { controller: "reply-toggle" } }
  .flex.gap-3.p-4.border.border-slate-200.rounded-lg.bg-white
    = render 'shared/user_avatar', user: note.author, size: 32, css_class: 'w-8 h-8 rounded-full flex-shrink-0'

    .flex-1.min-w-0
      .flex.items-center.justify-between.mb-1
        .flex.items-center.gap-2
          %span.font-medium.text-sm= note.author.name
          %span.text-xs.text-slate-500
            = "#{time_ago_in_words(note.created_at)} ago"
            - if note.last_edited_at.present?
              %span.text-xs.text-slate-400.ml-1 (edited)

        .flex.gap-1.text-xs.text-slate-500
          - if note.root_note?
            - if note.has_replies?
              = button_to "#{note.reply_count} replies", replies_namespace_project_note_path(note.noteable.project.namespace.parent.full_path, note.noteable.project.path, note), method: :post, class: "hover:text-slate-700 text-xs bg-transparent border-0 px-1 py-0.5 underline", remote: true, data: { turbo_frame: "note-#{note.id}-replies", action: "click->reply-toggle#toggle" }
            - else
              = button_to "Reply", replies_namespace_project_note_path(note.noteable.project.namespace.parent.full_path, note.noteable.project.path, note), method: :post, class: "hover:text-slate-700 text-xs bg-transparent border-0 px-1 py-0.5", remote: true, data: { turbo_frame: "note-#{note.id}-replies", action: "click->reply-toggle#toggle" }
          = button_to 'Edit', note_edit_path(note), remote: true, class: 'hover:text-slate-700 bg-transparent border-0 px-1 py-0.5 text-xs', form_class: 'inline'
          = link_to 'Delete', note_path(note), class: 'hover:text-red-600 text-xs px-1 py-0.5', data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this comment?' }

      .prose.prose-sm.max-w-none.markdown= note.note_html.html_safe

      - if note.root_note?
        .replies-container{ id: "replies_#{note.id}" }
        = turbo_frame_tag "note-#{note.id}-replies", data: { "reply-toggle-target": "repliesContainer" } do
          .replies-placeholder
