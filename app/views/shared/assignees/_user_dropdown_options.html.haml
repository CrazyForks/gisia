%div{ id: "user-dropdown-options-#{@field_type || 'assignees'}" }
  - if users.empty?
    %div{ class: 'px-3 py-2 text-slate-500 text-sm' } Type to search users...
  - else
    - users.each do |user|
      - is_selected = defined?(selected_ids) && selected_ids&.include?(user.id)
      - bg_class = is_selected ? 'bg-blue-50 hover:bg-blue-100' : 'hover:bg-slate-50'
      %div{ class: "px-3 py-2 #{bg_class} cursor-pointer border-b border-slate-100 last:border-b-0 flex items-center justify-between", data: { action: 'click->user-select-dropdown#selectUser', user_id: user.id, username: user.username, name: user.name } }
        %div{ class: 'flex items-center gap-2' }
          = render 'shared/user_avatar', user: user, size: 24, css_class: 'w-6 h-6 rounded-full'
          %div{ class: 'flex flex-col' }
            %span{ class: "text-sm font-medium text-slate-900" }= user.username
            - if user.name.present?
              %span{ class: 'text-xs text-slate-500' }= user.name
        - if is_selected
          %div{ class: 'text-blue-600' }
            = icon 'check', class: 'w-4 h-4'