= form_with model: @token, url: users_settings_personal_access_tokens_path do |f|

  - if @token.errors.any?
    %div{class: 'bg-red-50 border border-red-200 p-4 rounded-lg mb-6'}
      %ul{class: 'text-red-700 text-sm space-y-1'}
        - @token.errors.full_messages.each do |message|
          %li= message

  %div{class: 'space-y-5 mb-6'}

    %div
      = f.label :name, 'Token name', class: 'text-sm font-medium text-gray-700 mb-1'
      = f.text_field :name, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm', placeholder: 'e.g., my-script-token', required: true

    %div
      = f.label :expires_at, 'Expiration date', class: 'text-sm font-medium text-gray-700 mb-1'
      = f.date_field :expires_at, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm', min: Date.tomorrow.to_s

    %div
      = f.label :description, class: 'text-sm font-medium text-gray-700 mb-1' do
        Description
        %span{class: 'text-gray-400 font-normal'} (optional)
      = f.text_area :description, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm', rows: 2, placeholder: 'What is this token for?', maxlength: 255

    %div
      %label{class: 'text-sm font-medium text-gray-700 mb-2'} Scopes
      %div{class: 'space-y-2'}
        - PersonalAccessToken::AVAILABLE_SCOPES.each do |scope|
          %label{class: 'flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer'}
            = check_box_tag 'personal_access_token[scopes][]', scope.to_s, @token.scopes&.include?(scope.to_s), id: "scope_#{scope}", class: 'mt-0.5 rounded border-gray-300 text-blue-600 focus:ring-blue-500'
            %div
              %span{class: 'text-sm font-medium text-gray-900'}= scope
              %p{class: 'text-xs text-gray-500 mt-0.5'}
                - case scope
                - when :api
                  Full access to the API, including read and write.
                - when :read_api
                  Read-only access to the API.

  %div{class: 'flex items-center justify-between pt-4 border-t border-gray-100'}
    = link_to users_settings_personal_access_tokens_path, class: 'text-gray-600 hover:text-gray-800 text-sm font-medium' do
      Cancel
    = f.submit 'Create personal access token', class: 'inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors cursor-pointer'
