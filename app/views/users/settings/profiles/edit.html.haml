- nodes = [{ label: 'User Settings', path: users_settings_profile_path }, { label: 'Edit Profile', path: users_settings_profile_path}]
= render 'shared/breadcrumb', nodes: nodes

%div{class: 'w-full bg-white p-2 rounded-lg'}
  %div{class: 'w-full max-w-6xl mx-auto'}

    %div{class: 'py-6'}
      %div{class: 'flex items-center gap-4 mb-6'}
        %div{class: 'w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white text-xl font-bold shadow-lg'}
          = @user.name&.first&.upcase || @user.username&.first&.upcase || 'U'
        %div
          %h1{class: 'text-2xl font-bold text-gray-900'} Edit Profile
          %p{class: 'text-gray-600'} Update your personal information

    = form_with model: @user, url: users_settings_profile_path, method: :patch, local: true, html: { multipart: true } do |f|
      
      - if @user.errors.any?
        %div{class: 'bg-red-50 border border-red-200 p-4 rounded-lg mb-6'}
          %h3{class: 'text-red-800 font-medium mb-2'} Please correct the following errors:
          %ul{class: 'text-red-700 text-sm space-y-1'}
            - @user.errors.full_messages.each do |message|
              %li= message

      %div{class: 'space-y-5 mb-6'}

        %div
          = f.label :avatar, class: 'flex items-center gap-2 text-sm font-medium text-gray-700 mb-2' do
            = icon 'camera', class: 'w-4 h-4 text-indigo-500'
            Avatar
          %div{class: 'flex items-center gap-4', data: { controller: 'avatar-preview' }}
            %div{id: 'avatar-preview', class: 'w-12 h-12 rounded-full overflow-hidden shadow', data: { 'avatar-preview-target': 'preview', 'default-text': (@user.name&.first&.upcase || @user.username&.first&.upcase || 'U') }}
              = render 'shared/user_avatar', user: @user, size: 48, css_class: 'w-full h-full rounded-full'
            %div{class: 'flex-1'}
              = f.file_field :avatar, accept: 'image/*', data: { action: 'change->avatar-preview#preview', 'avatar-preview-target': 'input' }, class: 'block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border file:border-gray-300 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 hover:file:border-blue-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500'
              %p{class: 'text-xs text-gray-500 mt-1'} PNG, JPG, GIF up to 200KB. Ideal size: 192x192 pixels.

        %div
          = f.label :email, class: 'flex items-center gap-2 text-sm font-medium text-gray-700 mb-2' do
            = icon 'envelope', class: 'w-4 h-4 text-blue-500'
            Email
          = f.text_field :email, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'
        
        %div
          = f.label :username, class: 'flex items-center gap-2 text-sm font-medium text-gray-700 mb-2' do
            = icon 'at', class: 'w-4 h-4 text-green-500'
            Username
          = f.text_field :username, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'
        
        %div
          = f.label :name, class: 'flex items-center gap-2 text-sm font-medium text-gray-700 mb-2' do
            = icon 'user', class: 'w-4 h-4 text-purple-500'
            Full Name
          = f.text_field :name, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'
        
        %div
          = f.label :mobile, class: 'flex items-center gap-2 text-sm font-medium text-gray-700 mb-2' do
            = icon 'phone', class: 'w-4 h-4 text-orange-500'
            Mobile
          = f.text_field :mobile, class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'

      %div{class: 'flex items-center justify-between pt-4 border-t border-gray-100'}
        = link_to users_settings_profile_path, class: 'text-gray-600 hover:text-gray-800 text-sm font-medium' do
          Cancel
        %div{class: 'flex items-center gap-3'}
          = f.submit 'Save Changes', class: 'inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-all duration-200'
